{% extends "base.html" %}

{% block button %}
  <a class="px-6 py-2 bg-primary/10 text-primary dark:bg-primary/20 dark:text-primary rounded-full font-semibold hover:bg-primary/20" href="/">
    Logout
  </a>
{% endblock %}

{% block content %}
<section class="max-w-3xl mx-auto mt-10 bg-white dark:bg-[#052e16] p-6 rounded-xl shadow-lg">
  <h1 class="text-3xl font-bold text-primary text-center mb-6">Chatbot Assistant</h1>

  <div id="chatbox" class="h-96 overflow-y-auto p-4 bg-gray-100 dark:bg-[#041c10] rounded-lg space-y-3">
    <!-- Chat messages appear here -->
  </div>

  <div class="mt-4 flex gap-3">
    <input 
      id="user_input"
      type="text" 
      class="flex-1 px-4 py-2 rounded-lg border bg-white dark:bg-[#041c10]"
      placeholder="Ask somethingâ€¦">
    
    <button onclick="sendMessage()" 
      class="px-4 py-2 bg-primary text-white rounded-lg">
      Send
    </button>
  </div>
</section>

<script>
function sendMessage() {
  let msg = document.getElementById("user_input").value;
  if (!msg.trim()) return;

  // Show user message
  let chatbox = document.getElementById("chatbox");
  chatbox.innerHTML += `
    <div class='text-right'>
      <span class='inline-block bg-primary text-white px-3 py-2 rounded-lg'>${msg}</span>
    </div>
  `;

  document.getElementById("user_input").value = "";

  // Send to backend
  fetch("/chatbot/ask", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ question: msg })
  })
  .then(res => res.json())
  .then(data => {
    chatbox.innerHTML += `
      <div class='text-left'>
        <span class='inline-block bg-gray-300 dark:bg-gray-700 text-black dark:text-white px-3 py-2 rounded-lg'>
          ${data.answer}
        </span>
      </div>
    `;
    chatbox.scrollTop = chatbox.scrollHeight;
  });
}
</script>

{% endblock %}
